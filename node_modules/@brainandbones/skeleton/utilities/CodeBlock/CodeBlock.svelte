<!-- <svelte:options accessors /> -->
<script>import { storeHighlightJs } from './stores';
import { clipboard } from '../../actions/Clipboard/clipboard';
// Props
export let language = 'plaintext';
export let code = '';
// Props (design)
export let background = 'bg-[#141517]';
export let text = 'text-sm';
export let color = 'text-white';
export let rounded = 'rounded-container-token';
export let buttonCopy = 'bg-white/5 hover:bg-white/10';
// Base Classes
const cBase = 'overflow-hidden shadow';
const cHeader = 'text-xs uppercase flex justify-between items-center p-2 pl-4';
const cPre = 'whitespace-pre-wrap break-all p-4 pt-1';
// Local
let formatted = false;
let displayCode = code;
let copyState = false;
// Allow shorthand 'js' alias for Javascript
function languageFormatter(lang) {
    if (lang === 'js')
        return 'javascript';
    return lang;
}
// Handle Copy Text
function onCopyClick() {
    copyState = true;
    // prettier-ignore
    setTimeout(() => { copyState = false; }, 2000);
}
// Trigger syntax highlighting if highlight.js is available
$: if ($storeHighlightJs !== undefined) {
    displayCode = $storeHighlightJs.highlight(code, { language }).value.trim();
    formatted = true;
}
// Reactive
$: classesBase = `${cBase} ${background} ${text} ${color} ${rounded} ${$$props.class ?? ''}`;
</script>

<!-- prettier-ignore -->
{#if language && code}
<div class="code-block {classesBase}" data-testid="code-block">
	<!-- Header -->
	<header class="code-block-header {cHeader} {background} sticky top-0">
		<!-- Language -->
		<span class="code-block-language text-white/60">{languageFormatter(language)}</span>
		<!-- Copy Button -->
		<button class="code-block-btn btn btn-sm {buttonCopy}" on:click={onCopyClick} use:clipboard={code}>
			{!copyState ? 'Copy' : 'Copied âœ“'}
		</button>
	</header>
	<!-- Pre/Code -->
	<pre class="code-block-pre {cPre}"><code class="code-block-code language-{language}">{#if formatted}{@html displayCode}{:else}{code.trim()}{/if}</code></pre>
</div>
{/if}
