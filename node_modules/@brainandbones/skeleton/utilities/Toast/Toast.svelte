<script>import { fly, fade } from 'svelte/transition';
import { toastStore } from './stores';
// Props
export let background = 'bg-accent-500';
export let position = 'b'; // bottom
export let button = 'btn-ghost';
export let duration = 250;
// Base Classes
const cBaseToast = 'fixed z-50 flex items-center mx-auto py-3 px-4 max-w-[480px] space-x-4 rounded-xl';
const cBaseMessage = 'flex-1 text-base';
const cBaseActions = 'flex-none space-x-2';
// Set Position
let y = 100;
let cPosition;
// prettier-ignore
switch (position) {
    // Centered
    case ('t'):
        cPosition = 'left-4 right-4 top-4';
        y = -100;
        break;
    case ('b'):
        cPosition = 'left-4 right-4 bottom-4';
        break;
    // Corners
    case ('tr'):
        cPosition = 'top-4 right-4 ml-4';
        y = -100;
        break;
    case ('tl'):
        cPosition = 'top-4 left-4 mr-4';
        y = -100;
        break;
    case ('br'):
        cPosition = 'bottom-4 right-4 ml-4';
        break;
    case ('bl'):
        cPosition = 'bottom-4 left-4 mr-4';
        break;
    default: cPosition = 'left-4 right-4 bottom-4';
}
// Functionality
function onAction() {
    $toastStore[0].button.action();
    toastStore.close();
}
function onDismiss() {
    toastStore.close();
}
// Reactive Classes
$: classesToast = `${cBaseToast} ${background} ${cPosition}`;
</script>

{#if $toastStore.length}
	<div class="toast {classesToast}" transition:fly|local={{ y, duration }} data-testid="toast" role="alert" aria-live="polite">
		<!-- Message -->
		{#key $toastStore[0].message}
			<div class="toast-message {cBaseMessage}" in:fade={{ duration: 250 }}>
				{@html $toastStore[0].message}
			</div>
		{/key}

		<!-- Action -->
		<div class="toast-actions {cBaseActions}">
			{#if $toastStore[0].button}<button class="btn {button}" on:click={onAction}>{$toastStore[0].button.label}</button>{/if}
			<button class="btn {button}" on:click={onDismiss}>
				{@html $toastStore[0].button ? '&#10005;' : 'Dismiss'}
			</button>
		</div>
	</div>
{/if}
